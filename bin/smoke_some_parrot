#!/usr/bin/perl

use File::Temp qw/ tempdir /;

my $perl        = shift || 'perl';
my $branch      = shift || 'parrot-HEAD';
my $make        = $^O =~ /bsd/i ? 'gmake' : 'make';
my $smoke_dir   = tempdir( CLEANUP => 1 );
my $rsync       = 'rsync';
my $rsync_flags = '-av --delete';
my $svnhost     = 'svn.perl.org';
my $checkout    = qq{ cd $smoke_dir && $rsync $rsync_flags ${svnhost}::$branch $parrot };
my $smoke       = qq{ cd $parrot && $perl Configure.pl && $make smoke ; cd ..};

system "$checkout && $smoke";
if( $? == -1 ){
    print "Failed to smoke Parrot: $!\n";
} else {
    print "You just smoked a Parrot!\n";
}
